##  Laboratorio Kenobi: Explotaci贸n y An谩lisis de Servidor Linux

En este laboratorio, realic茅 una auditor铆a de seguridad sobre una m谩quina Linux para identificar fallos de configuraci贸n en servicios de red y escalar privilegios hasta obtener acceso de superusuario (root).

### 1. Fase de Reconocimiento y Escaneo de Versiones
Utilic茅 **Nmap** con scripts de enumeraci贸n y detecci贸n de servicios para mapear la superficie de ataque.

**Comando utilizado:**
`nmap -sV -sC -Pn -oN escaneo_kenobi.txt 10.67.177.242`

**Resultados clave:**
* Se identificaron servicios de transferencia de archivos (FTP) y compartici贸n de recursos (Samba/NFS).
* Se detect贸 la versi贸n **ProFTPD 1.3.5**, la cual presenta vulnerabilidades de copia arbitraria de archivos (mod_copy).
* El escaneo de SMB revel贸 un recurso compartido sin contrase帽a.

<img width="1910" height="932" alt="image" src="https://github.com/user-attachments/assets/955102bc-d100-487c-a0e8-1e4126d46ff3" />

### 2. Enumeraci贸n de SMB y Fuga de Informaci贸n
Al inspeccionar el recurso compartido `anonymous` mediante `smbclient`, localic茅 un archivo llamado `log.txt`. 

Al analizar su contenido, identifiqu茅 informaci贸n cr铆tica sobre la estructura del sistema, incluyendo la ruta de la clave privada SSH del usuario (`/home/kenobi/.ssh/id_rsa`). Esta informaci贸n es vital para la fase de explotaci贸n.

<img width="1910" height="922" alt="image" src="https://github.com/user-attachments/assets/f3396fd4-492c-4ece-a103-66a2f07d54bc" />

### 3. Explotaci贸n de ProFTPD (Vulnerabilidad mod_copy)

Tras identificar la versi贸n **ProFTPD 1.3.5**, proced铆 a explotar el m贸dulo `mod_copy`. Esta vulnerabilidad permite utilizar los comandos `SITE CPFR` (Copy From) y `SITE CPTO` (Copy To) para copiar archivos en el servidor sin necesidad de autenticaci贸n.

**Procedimiento realizado:**
1. Conexi贸n al puerto 21 mediante **Netcat** (`nc`).
2. Selecci贸n de la clave privada SSH del usuario objetivo: `SITE CPFR /home/kenobi/.ssh/id_rsa`.
3. Copiado de la clave a un directorio accesible mediante el montaje NFS: `SITE CPTO /var/tmp/id_rsa`.

Este paso es fundamental, ya que permite extraer la credencial necesaria para obtener acceso inicial al sistema v铆a SSH.

<img width="702" height="113" alt="image" src="https://github.com/user-attachments/assets/d5aa5b30-dd6e-4446-8eb5-54e9e3ccda3c" />

 ### 4. Acceso Inicial mediante SSH

Una vez que la clave privada (`id_rsa`) fue movida a un directorio accesible, proced铆 a descargarla a mi m谩quina local para establecer una sesi贸n remota.

**Pasos realizados:**
1. Descarga del archivo `id_rsa` mediante el montaje de red (NFS).
2. Asignaci贸n de permisos restrictivos para cumplir con los requisitos de seguridad de SSH: `chmod 600 id_rsa`.
3. Conexi贸n exitosa al servidor como el usuario **kenobi**: `ssh -i id_rsa kenobi@10.67.177.242`.

Este paso confirma que la vulnerabilidad de ProFTPD fue explotada con 茅xito para obtener presencia activa en el sistema.

<img width="870" height="728" alt="image" src="https://github.com/user-attachments/assets/2659873e-d7e2-4620-a5f9-96658e762a9a" />

### 5. Escalada de Privilegios (Path Hijacking)

Para la fase final del laboratorio, realic茅 una b煤squeda de archivos con el bit **SUID** (Set User ID) activo mediante el comando `find / -perm -u=s -type f 2>/dev/null`. Este bit permite que un archivo se ejecute con los privilegios del propietario (en este caso, root).

**Identificaci贸n y An谩lisis:**
Se detect贸 un binario inusual en la ruta `/usr/bin/menu`. Al analizarlo con el comando `strings`, observ茅 que el binario realizaba llamadas a comandos del sistema (como `ifconfig`) utilizando rutas relativas en lugar de rutas absolutas (ej: llamaba a `ifconfig` en lugar de `/sbin/ifconfig`).

**Explotaci贸n por Path Hijacking:**
Aprovech茅 esta vulnerabilidad para manipular la variable de entorno `$PATH` y enga帽ar al binario:
1. Me desplac茅 al directorio `/tmp` (con permisos de escritura).
2. Cre茅 un archivo falso llamado `ifconfig` que conten铆a el comando `/bin/sh` (una shell).
3. Otorgu茅 permisos totales de ejecuci贸n al script: `chmod 777 ifconfig`.
4. Modifiqu茅 temporalmente el **PATH** para que el sistema busque primero en el directorio actual: `export PATH=.:$PATH`.

Al ejecutar nuevamente `/usr/bin/menu` y seleccionar la opci贸n que invoca a `ifconfig`, el sistema ejecut贸 mi script malicioso con privilegios de **root**.

**Resultado:** Se obtuvo una shell con privilegios m谩ximos, confirmado mediante el comando `whoami`.

<img width="1241" height="357" alt="image" src="https://github.com/user-attachments/assets/4fad59ca-019e-466e-b34b-fbfd8d478eea" />

